<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reportes - Control de Accesos</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="layout">

    <!-- ===== MENÚ LATERAL ===== -->
    <aside class="sidebar">
        <h3>Control Accesos</h3>

        <a href="index.html">Registro</a>
        <a href="alertas.html">Alertas</a>

        <a id="menuDashboard" href="dashboard.html">Dashboard</a>
        <a id="menuReportes" href="reportes.html">Reportes</a>
        <button class="logout-btn" onclick="logout()">Cerrar sesión</button>
    </aside>


    <!-- ===== CONTENIDO ===== -->
    <main class="content">

        <div class="container">

            <h2>Reportes históricos</h2>

            <!-- ===== FILTROS ===== -->
            <label>Fecha</label>
            <input type="date" id="fechaReporte" onchange="paginaActual=1">

            <label>Punto de control</label>
            <select id="puntoReporte" onchange="paginaActual=1">
                <!-- Se genera dinámicamente desde puntos.js -->
            </select>

            <label>Tipo</label>
            <select id="tipoReporte" onchange="paginaActual=1">
                <option value="">Todos</option>
                <option value="Entrada">Entrada</option>
                <option value="Salida">Salida</option>
            </select>


            <button onclick="buscarReporte()">Buscar</button>

            <!-- ===== ACCIONES ===== -->
            <div style="margin-top:15px;">
                <button disabled> Exportar PDF</button>
                <button onclick="exportarExcel()">Exportar Excel</button>
            </div>

            <!-- ===== TABLA ===== -->
            <table id="tablaReporte">
                <thead>
                    <tr>
                        <th>Fecha / Hora</th>
                        <th>DNI</th>
                        <th>Nombre</th>
                        <th>Punto</th>
                        <th>Movimiento</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="paginacion">
                <button id="btnPrev" onclick="cambiarPagina(-1)">⬅ Anterior</button>

                <span id="infoPagina">
                    Página <strong id="paginaActual">1</strong>
                    de <strong id="totalPaginas">1</strong>
                </span>

                <button id="btnNext" onclick="cambiarPagina(1)">Siguiente ➡</button>
            </div>


        </div>

    </main>

</div>

<script src="js/api.js"></script>
<script src="js/puntos.js"></script>
<script src="js/reportes.js"></script>
<script src="js/auth.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const token = localStorage.getItem("token");
    const rol = localStorage.getItem("rol");

    // Sin sesión → login
    if (!token || !rol) {
        window.location.href = "login.html";
        return;
    }

    // Solo Admin puede estar aquí
    if (rol !== "Admin") {
        alert("Acceso no autorizado");
        window.location.href = "index.html";
        return;
    }

    // Generar opciones de puntos de control dinámicamente
    try {
        await generarOpcionesPuntos("puntoReporte", true);
    } catch (err) {
        console.error("Error cargando puntos de control:", err);
    }
});
</script>

</body>
</html>
